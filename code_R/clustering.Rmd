---
title: "R Notebook"
output: html_notebook
---

# 1. Sur les paramètres d'échotracking

## 1.1 Base de donnée

Contient les var d'echotraking centrées et réduites.
```{r}
list_var = param_et_select_univar[!(param_et_select_univar %in% c("pr_sence_de_plaque_s____l__cho"))]
```

```{r}
data_cl = scale(data_f[,list_var], center = T, scale = T)
```
```{r}
sum(is.na(data_cl))
```


```{r}
#head(data_cl)
```
```{r}
dim(data_cl)
```

## 1.2. Kmeans
```{r}
km3 = kmeans(t(data_cl[,list_var]), centers = 3, nstart = 50)
```

```{r}
km3$cluster
```


## 1.3 Algo EM 


```{r}
mclust1 = Mclust(t(data_cl[,list_var]), G = 3)
```
```{r}
summary(mclust1)
mclust1$classification
```

## 1.4 Classification Ascendante Hiérarchique avec distance de ward 2

```{r}
cah.wardD2 = hclust(dist(t(data_cl[,list_var])),method="ward.D2")
```
```{r}
#liste des groupes
groupes.cah = cutree(cah.wardD2, 3)
groupes.cah
```
## 1.5 Algo PAM 

```{r}
library(cluster)
pam = pam(t(data_cl[,list_var]), k = 3)
```

```{r}
pam$clustering
```


## 1.6 Visualisation

```{r}
fviz_cluster(km3, data = t(data_cl), main = "Kmeans")
fviz_cluster(mclust1, data = t(data_cl), main = "Algo EM - (Mclust)")
fviz_cluster(pam, main = "PAM (K-methoids")
plot(cah.wardD2, main = "CAH - critère de WARD2")
#dendrogramme avec matérialisation des groupes
rect.hclust(cah.wardD2,k=3)
```

# 2. Sur les sujets

## 2.1 Données

```{r}
data_cl_sj = as.data.frame(scale(data_f[,c(list_var,"mbp")],center = T, scale = T))
#data_cl_sj$plaques = data_f$pr_sence_de_plaque_s____l__cho 
```


## 2.2 Kmeans

```{r}
km3_sj = kmeans(data_cl_sj, centers = 3, nstart = 30)
```
```{r}
table(km3_sj$cluster)
```


```{r}
fviz_cluster(km3_sj, data = data_cl_sj, main = "Kmeans",ellipse = F)
```

```{r}
data_f$km3_sj = km3_sj$cluster
data_f$km3_sj = as.factor(data_f$km3_sj)
```


```{r}
CG_km3_sj = compareGroups( km3_sj~ .- nepp3 - time_to_deces - time_to_chd -deces- chd, data = data_f)


export_table = createTable(CG_km3_sj)
export_table
```

```{r}
data_f$km3_sj = relevel(data_f$km3_sj, ref = "2")
```

```{r}
summary(coxph(Surv(time_to_chd, chd) ~ age0 +  sexe + qm9 + qm16 + bmi + diab + bio10 + km3_sj, data = data_f))
```






## 2.1 CAH 

### 2.1.3 Avec HCPC
```{r}
res.pca = PCA(data_cl_sj, graph = F)
```


```{r}
res.HCPC = HCPC(res.pca, graph = F)
```

```{r}
plot(res.HCPC,choice = "3D.map")
```
```{r}
fviz_dend(res.HCPC, show_labels = FALSE)
```


```{r}
plot_grid(
fviz_cluster(km3_sj, data = data_cl_sj, main = "Kmeans",geom = "point"),
fviz_cluster(res.HCPC, geom = "point", main = "Factor map"))
```


### 2.1.2 Avec hclust

```{r}
cah.wardD2_sj = hclust(dist(data_cl_sj),method="ward.D2")
plot(cah.wardD2_sj, main = "CAH sujets - critère de WARD2")
rect.hclust(cah.wardD2_sj,k=3)
```

```{r}
groupes.cah_sj = cutree(cah.wardD2_sj, 3)
table(groupes.cah_sj)
data_f$hclust_sj = groupes.cah_sj
data_f$hclust_sj = as.factor(data_f$hclust_sj)
```




```{r}
summary(coxph(Surv(time_to_deces, deces) ~  hclust_sj , data = data_f))
```





## 2.3 Algo EM


```{r}
mclust_sj = Mclust(data_cl_sj[,list_var])
```
```{r}
summary(mclust_sj)
mclust_sj
table(mclust_sj$classification)
```
```{r}
data_f$mclust_sj = mclust_sj$classification
```

```{r}
CG_mclust_sj = compareGroups( mclust_sj ~ .- nepp3 - km3_sj, data = data_f)
#pv = getResults(CG_km3_sj , "p.overall")

export_table_mclust = createTable(CG_mclust_sj)
export_table_mclust
```
```{r}
mclust3_sj = Mclust(data_cl_sj, G = 3)
```
```{r}
summary(mclust3_sj)
table(mclust3_sj$classification)
```
```{r}
data_f$mclust_sj = mclust_sj$classification
```

```{r}
CG_mclust_sj = compareGroups( mclust_sj ~ .- nepp3 - km3_sj, data = data_f)
#pv = getResults(CG_km3_sj , "p.overall")

export_table_mclust = createTable(CG_mclust_sj)
export_table_mclust
```
